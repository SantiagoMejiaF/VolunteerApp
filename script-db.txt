
-- Creación de esquemas
CREATE SCHEMA IF NOT EXISTS modulo_gestion_usuarios;
CREATE SCHEMA IF NOT EXISTS modulo_gestion_voluntarios;
CREATE SCHEMA IF NOT EXISTS modulo_gestion_organizaciones;
CREATE SCHEMA IF NOT EXISTS modulo_gestion_misiones_y_actividades;

-- Tabla RoleEntity
CREATE TABLE modulo_gestion_usuarios.ROL (
    ID SERIAL PRIMARY KEY,
    TIPO_ROL VARCHAR(12) NOT NULL
);

-- Secuencia para UserEntity
CREATE SEQUENCE modulo_gestion_usuarios.SEQ_USUARIO
    INCREMENT 1
    START 1;

-- Tabla UserEntity
CREATE TABLE modulo_gestion_usuarios.USUARIO (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_usuarios.SEQ_USUARIO'),
    ROL_ID INTEGER NOT NULL REFERENCES modulo_gestion_usuarios.ROL(ID) ON DELETE CASCADE,
    ESTADO_AUTORIZACION VARCHAR(255) NOT NULL,
    NOMBRE VARCHAR(20),
    APELLIDO VARCHAR(20),
    CORREO VARCHAR(50) UNIQUE NOT NULL,
    IMAGEN VARCHAR(255),
    FECHA_REGISTRO DATE NOT NULL
);

-- Secuencia para VolunteerEntity
CREATE SEQUENCE modulo_gestion_voluntarios.SEQ_VOLUNTARIO
    INCREMENT 1
    START 1;

-- Tabla EmergencyInformationEntity
CREATE TABLE modulo_gestion_voluntarios.INFORMACION_EMERGENCIA (
    ID SERIAL PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL,
    APELLIDO VARCHAR(50) NOT NULL,
    TELEFONO VARCHAR(10) NOT NULL,
    CORREO VARCHAR(50) NOT NULL,
    PARENTESCO SMALLINT NOT NULL
);

-- Secuencia para PersonalInformationEntity
CREATE SEQUENCE modulo_gestion_voluntarios.SEQ_INFORMACION_PERSONAL
    INCREMENT 1
    START 1;

-- Tabla PersonalInformationEntity
CREATE TABLE modulo_gestion_voluntarios.INFORMACION_PERSONAL (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_voluntarios.SEQ_INFORMACION_PERSONAL'),
    CEDULA VARCHAR(10) UNIQUE NOT NULL,
    DIRECCION VARCHAR(50) NOT NULL,
    AGE INTEGER NOT NULL,
    BORN_DATE DATE NOT NULL,
    TELEFONO VARCHAR(10) NOT NULL
);

-- Secuencia para VolunteeringInformationEntity
CREATE SEQUENCE modulo_gestion_voluntarios.SEQ_INFORMACION_VOLUNTARIADO
    INCREMENT 1
    START 1;

-- Tabla VolunteeringInformationEntity
CREATE TABLE modulo_gestion_voluntarios.INFORMACION_VOLUNTARIADO (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_voluntarios.SEQ_INFORMACION_VOLUNTARIADO'),
    HORAS_VOLUNTARIADAS INTEGER NOT NULL,
    TIPO_VOLUNTARIO VARCHAR(10) NOT NULL
);

-- Tabla VolunteerEntity
CREATE TABLE modulo_gestion_voluntarios.VOLUNTARIO (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_voluntarios.SEQ_VOLUNTARIO'),
    USUARIO_ID INTEGER UNIQUE NOT NULL,
    INFORMACION_PERSONAL_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_PERSONAL(ID) ON DELETE CASCADE,
    INFORMACION_VOLUNTARIADO_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_VOLUNTARIADO(ID) ON DELETE CASCADE,
    INFORMACION_EMERGENCIA_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_EMERGENCIA(ID) ON DELETE CASCADE
);

-- Secuencia para OrganizationEntity
CREATE SEQUENCE modulo_gestion_organizaciones.SEQ_ORGANIZACION
    INCREMENT 1
    START 1;

-- Tabla OrganizationEntity
CREATE TABLE modulo_gestion_organizaciones.ORGANIZACION (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_organizaciones.SEQ_ORGANIZACION'),
    USUARIO_ID INTEGER UNIQUE NOT NULL,
    CEDULA_RESPONSABLE VARCHAR(10) UNIQUE NOT NULL,
    TELEFONO_RESPONSABLE VARCHAR(10) NOT NULL,
    NOMBRE_ORGANIZACION VARCHAR(50) NOT NULL,
    TIPO_ORGANIZACION VARCHAR(21),
    SECTOR VARCHAR(50) NOT NULL,
    TIPO_VOLUNTARIADO VARCHAR(21),
    NIT VARCHAR(10) UNIQUE NOT NULL,
    DIRECCION_ORGANIZACION VARCHAR(50) NOT NULL
);

-- Secuencia para MissionEntity
CREATE SEQUENCE modulo_gestion_misiones_y_actividades.SEQ_MISION
    INCREMENT 1
    START 1;

-- Tabla MissionEntity
CREATE TABLE modulo_gestion_misiones_y_actividades.MISION (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_misiones_y_actividades.SEQ_MISION'),
    ORGANIZACION_ID INTEGER NOT NULL REFERENCES modulo_gestion_organizaciones.ORGANIZACION(ID) ON DELETE CASCADE,
    TITULO VARCHAR(100) NOT NULL,
    DESCRIPCION VARCHAR(1000),
    FECHA DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    HORA_FIN TIME NOT NULL,
    DIRECCION VARCHAR(200) NOT NULL,
    NUMERO_VOLUNTARIOS_REQUERIDOS INTEGER NOT NULL,
    HORAS_REQUERIDAS INTEGER,
    ESTADO VARCHAR(10) NOT NULL,
    OBSERVACIONES VARCHAR(1000),
    CIUDAD VARCHAR(200) NOT NULL,
    FECHA_FIN DATE NOT NULL,
    ES_PUBLICA BOOLEAN NOT NULL,
    TIPO_MISION VARCHAR(15) NOT NULL CHECK (TIPO_MISION IN ('EDUCACION', 'SALUD', 'MEDIO_AMBIENTE', 'CULTURA', 'DEPORTE', 'SOCIAL', 'ANIMALISTA', 'INFANCIA', 'ADULTOS_MAYORES', 'DISCAPACIDAD', 'EMERGENCIA', 'OTRO')),
    FECHA_INICIO DATE NOT NULL
);

-- Secuencia para ActivityEntity
CREATE SEQUENCE modulo_gestion_misiones_y_actividades.SEQ_ACTIVIDAD
    INCREMENT 1
    START 1;

-- Tabla ActivityEntity
CREATE TABLE modulo_gestion_misiones_y_actividades.ACTIVIDAD (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_misiones_y_actividades.SEQ_ACTIVIDAD'),
    MISSION_ID INTEGER NOT NULL REFERENCES modulo_gestion_misiones_y_actividades.MISION(ID) ON DELETE CASCADE,
    TITULO VARCHAR(100) NOT NULL,
    DESCRIPCION VARCHAR(1000),
    FECHA DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    HORA_FIN TIME NOT NULL,
    DIRECCION VARCHAR(200) NOT NULL,
    NUMERO_VOLUNTARIOS_REQUERIDOS INTEGER NOT NULL,
    HORAS_REQUERIDAS INTEGER,
    ESTADO VARCHAR(10) NOT NULL,
    OBSERVACIONES VARCHAR(1000)
);

-- Creación de tablas para enums y colecciones
CREATE TABLE modulo_gestion_voluntarios.DIAS_DISPONIBLES_VOLUNTARIO (
    INFORMACION_VOLUNTARIADO_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_VOLUNTARIADO(ID),
    DIA VARCHAR(255)
);

CREATE TABLE modulo_gestion_voluntarios.INTERESES_VOLUNTARIO (
    INFORMACION_VOLUNTARIADO_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_VOLUNTARIADO(ID),
    INTERESES VARCHAR(255)
);

CREATE TABLE modulo_gestion_voluntarios.HABILIDADES_VOLUNTARIO (
    INFORMACION_VOLUNTARIADO_ID INTEGER REFERENCES modulo_gestion_voluntarios.INFORMACION_VOLUNTARIADO(ID),
    HABILIDADES VARCHAR(255)
);

-- Secuencia para GrupoVoluntario
CREATE SEQUENCE modulo_gestion_misiones_y_actividades.seq_grupo_voluntario
    INCREMENT 1
    START 1;

-- Nuevas tablas y columnas según los cambios
CREATE TABLE modulo_gestion_misiones_y_actividades.GRUPO_VOLUNTARIO (
    ID INTEGER PRIMARY KEY DEFAULT nextval('modulo_gestion_misiones_y_actividades.seq_grupo_voluntario'),
    NOMBRE VARCHAR(100) NOT NULL,
    NUMERO_VOLUNTARIOS_REQUERIDOS INTEGER NOT NULL,
    OBSERVACIONES VARCHAR(1000),
    ACTIVITY_ID INTEGER NOT NULL REFERENCES modulo_gestion_misiones_y_actividades.ACTIVIDAD(ID) ON DELETE CASCADE,
    ORGANIZACION_ID INTEGER REFERENCES modulo_gestion_organizaciones.ORGANIZACION(ID) ON DELETE CASCADE
);

CREATE TABLE modulo_gestion_misiones_y_actividades.HABILIDADES_REQUERIDAS (
    MISSION_ID INTEGER NOT NULL REFERENCES modulo_gestion_misiones_y_actividades.MISION(ID) ON DELETE CASCADE,
    HABILIDADES VARCHAR(255) CHECK (HABILIDADES IN ('COMUNICACION', 'ORGANIZACION', 'LIDERAZGO', 'TRABAJO_EN_EQUIPO', 'PRIMEROS_AUXILIOS', 'EDUCACION', 'GESTION_DE_PROYECTOS', 'MARKETING', 'FINANZAS', 'TECNOLOGIA', 'IDIOMAS'))
);

CREATE TABLE modulo_gestion_misiones_y_actividades.MIEMBROS_GRUPO_VOLUNTARIO (
    GRUPO_ID INTEGER NOT NULL REFERENCES modulo_gestion_misiones_y_actividades.GRUPO_VOLUNTARIO(ID) ON DELETE CASCADE,
    VOLUNTARIO_ID INTEGER NOT NULL REFERENCES modulo_gestion_voluntarios.VOLUNTARIO(ID) ON DELETE CASCADE
);

CREATE TABLE modulo_gestion_misiones_y_actividades.REQUISITOS_REQUERIDOS (
    MISSION_ID INTEGER NOT NULL REFERENCES modulo_gestion_misiones_y_actividades.MISION(ID) ON DELETE CASCADE,
    REQUISITOS VARCHAR(255)
);